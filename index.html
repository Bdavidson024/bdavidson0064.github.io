<!DOCTYPE html>
<html><head>  <meta charset="UTF-8">
      <title>CIT140: Program 5</title>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.1.2/handlebars.min.js"></script>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>

<body>
     <div class="container">
          <h1>Select a Major</h1>
          <button type="button" id='btn' onclick="getData('CIT')">CIT Majors</button>
          <button type="button" id='btn2' onclick="getData('BUS')">Business Majors</button><br>
      
     <h2>We filter our dataset by major</h2>
     </div>
     <div id="studentTable"></div>
</body>

<script id="tableTemplate" type="text/x-handlebars-template">
     <h2>CIT Majors</h2>
     <table class="table table-striped table-bordered" id="studentTable" cellspacing="7">
        <tr><th>Name</th><th>Major</th><th>Midterm</th><th>Final</th></tr>
          {{#each rows}}
               <tr>
                  <td>{{Name}}</td><td>{{Major}}</td><td>{{Midterm}}</td><td>{{Final}}</td>
               </tr>
          {{/each}}   
     </table>      
</script>


<script> 
	
     function getData(selectedMajor){
        	var request = new XMLHttpRequest();
          var url = "https://bdavidson0064.github.io/cit5students.json";
        	request.open('GET', url);

        	request.onload = function(){
            	var data = JSON.parse(request.responseText);
               studentMajors = data.filter(getMajor)

          function getMajor(item){
               return item.major == selectedMajor;

          }

            	if (request.status == 200) {
            		var templateText = document.getElementById('tableTemplate').innerHTML;
                    var compiledTemplateText = Handlebars.compile(templateText);
                    compiledHtml = compiledTemplateText({rows: studentMajors})
                    document.getElementById('studentTable').innerHTML = compiledHtml;
               }
			else {
                    document.querySelector('#studentTable').innerHTML = "There was an error.";
               }		

        request.send(null);
    
	}
   
</script>
</html>
